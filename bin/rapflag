#!/usr/bin/env ruby
dir =  File.expand_path(File.dirname(File.dirname(__FILE__)))
$LOAD_PATH << File.join(dir, 'lib')
require 'rapflag/version'
require 'rapflag/config'
require 'rapflag/fetch'
require 'trollop'

begin
require 'pry'
rescue LoadError
end

Opts = Trollop::options do
  opt :clean, "Create summary of transactions by day"
end

RAPFLAG::Wallets.each do |wallet|
   RAPFLAG::Config['currencies'].each do |currency|
    rap = RAPFLAG::History.new(wallet, currency)
    rap.fetch_csv_history
    rap.create_csv_file
    rap.create_summary if Opts[:clean]
  end
end
